# 엔티티와 매핑

### 목차
1. [엔티티 매핑](https://github.com/hongcoding94/JPA_storage/blob/main/JPA_%EC%9D%B4%EB%A1%A0/JPA_%EC%A0%95%EB%A6%AC/004.%20%EC%97%94%ED%8B%B0%ED%8B%B0%EC%99%80%20%EB%A7%A4%ED%95%91.md#1-%EC%97%94%ED%8B%B0%ED%8B%B0-%EB%A7%A4%ED%95%91)
2. [앤티티 매핑 4가지 분류의 어노테이션 설명](https://github.com/hongcoding94/JPA_storage/blob/main/JPA_%EC%9D%B4%EB%A1%A0/JPA_%EC%A0%95%EB%A6%AC/004.%20%EC%97%94%ED%8B%B0%ED%8B%B0%EC%99%80%20%EB%A7%A4%ED%95%91.md#2-%EC%95%A4%ED%8B%B0%ED%8B%B0-%EB%A7%A4%ED%95%91-4%EA%B0%80%EC%A7%80-%EB%B6%84%EB%A5%98%EC%9D%98-%EC%96%B4%EB%85%B8%ED%85%8C%EC%9D%B4%EC%85%98-%EC%84%A4%EB%AA%85)
3. [IDENTITY와 SEQUENCE 차이](https://github.com/hongcoding94/JPA_storage/blob/main/JPA_%EC%9D%B4%EB%A1%A0/JPA_%EC%A0%95%EB%A6%AC/004.%20%EC%97%94%ED%8B%B0%ED%8B%B0%EC%99%80%20%EB%A7%A4%ED%95%91.md#3-identity%EC%99%80-sequence-%EC%B0%A8%EC%9D%B4)
4. []()
5. [참고자료](https://github.com/hongcoding94/JPA_storage/blob/main/JPA_%EC%9D%B4%EB%A1%A0/JPA_%EC%A0%95%EB%A6%AC/004.%20%EC%97%94%ED%8B%B0%ED%8B%B0%EC%99%80%20%EB%A7%A4%ED%95%91.md#5-%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C)

---

### 1. 엔티티 매핑

> JPA를 사용할 때 엔티티와 테이블을 정확하게 매핑 하는 것이 중요하다.<br/>
> JPA는 매핑 어노테이션을 지원하는데 아래와 같이 크게 4가지로 분류한다.

- 엔티티 매핑 4가지 분류 및 예시 매핑
  - 객체와 테이블 매핑
    - @Entity
    - @Table
  - 기본키 매핑
    - @Id
    - @GeneratedValue
  - 필드와 컬럼 매핑
    - @Column
  - 연관관계 매핑
    - @ManyToOne
    - @JoinColumn 

### 2. 앤티티 매핑 4가지 분류의 어노테이션 설명
- 객체와 테이블 매핑
  --- 
  - @Entity 
    > JPA를 사용해서 테이블과 매핑할 클래스는 @Entity 어노테이션을 필수로 붙여야한다.

    - @Entity 적용시 주의사항
      - 기본 생성자는 필수
      - final 클래스, enum, interface, inner 클래스에는 사용 불가
      - 저장할 필드에 final을 사용을 금지

    - 속성 
      - Name : JPA에서 사용할 엔티티 이름을 지정<br/>
        &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 보통 기본값인 클래스 이름을 사용 

    - @entity 시각화gif만드는 중


  - @Table
    > 엔티티와 매핑할 테이블을 지정한다. (생략하면 매핑한 엔티티 이름을 테이블 이름으로 사용함.)

    - 속성
      - Name : 매핑할 테이블 이름 / default. Entity 이름
      - Catalog : catalog 기능이 있는 DB에서 catalog를 매핑 / default. DB명
      - Schema : schema 기능이 있는 DB에서 schema를 매핑
      - uniqueConstraints : DDL 생성 시 유니크 제약조건을 만듬<br/>
        &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
        스키마 자동 생성 기능을 사용해서 DDL을 만들 때만 사용

      🔹 TIP1. Catalog가 무엇인가?<br/>

      🔹 TIP2. Schema가 무엇인가?<br/>

      🔹 TIP3. DDL이 무엇인가?<br/>

     - @table설정 시각화gif만드는 중

  - 데이터베이스 스키마 자동 생성
    > JPA는 데이터베이스 스키마를 자동으로 생성하는 기능을 지원하며 클래스의 매핑 정보와 데이터베이스 방언을 사용하여 데이터베이스 스키마 생성<br/>
    > 단, 애플리케이션 실행 시점에 데이터베이스 테이블을 자동으로 생성한다.

    - hibernate 속성
      - create : 기존 테이블을 삭제하고 새로 생성(DROP + CREATE)
      - create-drop : CREATE 속성에 추가로 애플리케이션을 종료할 때 생성한 DDL을 제거(DROP + CREATE + DROP)
      - update : DB 테이블과 엔티티 매핑 정보를 비교해서 변경 사항만 수정
      - validate : DB 테이블과 엔티티 매핑정보를 비교해서 차이가 있으면 경고를 남기고 애플리케이션을 실행하지 않음.<br/>
        &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DDL을 수행하지 않음
      - none : 자동 생성 기능을 사용하지 않음

    - 데이터베이스 스키마 자동 생성의 주의사항
      - 개발 초기 단계는 create or update 
      - 초기화 상태로 자동화된 테스트를 진행하는 개발자 환경과 CI서버는 create or create-drop
      - 테스트 서버는 update or valudate
      - 스테이징과 운영 서버는 validate or none

    - 데이터베이스 스키마설정 시각화gif만드는 중

- 기본키 매핑
  ---
  - @Id
    > 데이터베이스 테이블의 기본 키(PK)와 객체의 필드를 매핑시켜주는 어노테이션

    - @Id를 생성시 주의사항
      - @Id만 사용할 경우 기본 키를 직접 할당
      - 기본 키를 직접 할당하는 대신 데이터베이스가 생성해주는 값을 사용하려면 @GeneratedValue를 사용

    - @Id 설정 시각화 gif 만드는 중

  - @GeneratedValue
    > 기본 키를 자동 생성해주는 어노테이션 

    - 속성
      - strategy = GeberatuibType.IDENTITY
      - strategy = GenerationType.SEQUENCE, generator = "시퀀스생성명"

    
    - @GeneratedValue의 각 속성들의 내용 설명
      - strategy = GeberatuibType.IDENTITY
        > 기본키 생성을 데이터베이스에 위임하는 전략<br/>
        > 주로 MySQL, PostgreSQL, SQL Server에서 사용 예로 들어 MySQL의 AUTO_INCREMENT 기능은 데이터베이스가 기본 키를 자동 생성한다.<br/>
        > 단, IDEBTITY 전략은 AUTO_INCREMENT처럼 데이터베이스에  값을 저장하고 나서야 기본 키 값을 구할 수 있을 떄 사용
        
        - GeberatuibType.IDENTITY 사용시 주의사항
          - 엔티티가 영속 상태가 되기 위해서는 식별자가 필수
          - 그런데 IDENTITY 전략을 사용하면 식별자를 데이터베이스에서 지정하기 전까지는 알 수 없기 때문에,<br/>
            em.persist()를 하는 즉시 INSERT SQL이 데이터베이스에 전달 따라서 트랜잭션을 지원하는 <b>"쓰기 지연이 동작하지 않는다."</b>

      - strategy = GenerationType.SEQUENCE, generator = "시퀀스생성명"
        > 유일한 값을 순서대로 생성하는 데이터베이스 오브젝트이다.<br/>
        > SEQUENCE 전략은 이 시퀀스를 사용해서 기본 키를 생성하기 때문에 시퀀스를 지원하는 Oracle, PostgreSQL, H2를 데이터베이스를 사용할 수 있다.
         
        - @SequenceGenerator 속성
          - Name : 식별자 생성기 이름
          - sequenceName : 데이터베이스에 등록되어 있는 시퀀스 이름
          - initialValue : DDL생성 시에만 사용<br/>
            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
            시퀀스 DDL을 생성할 때 처음 시작하는 수를 지정
          - allocationSize : 시퀀스를 한 번 호출 할 때마다 카운트를 증가한다.(성능 최적화에 사용)
          - catalog : catalog 기능이 있는 DB에서 catalog를 매핑 / default. DB명
          - schema : schema 기능이 있는 DB에서 schema를 매핑

    🔹 TIP4. IDENTITY와 SEQUENCE 차이는 뭘까?<br/>
       > 해당 내용은 [3. IDENTITY와 SEQUENCE 차이](https://github.com/hongcoding94/JPA_storage/blob/main/JPA_%EC%9D%B4%EB%A1%A0/JPA_%EC%A0%95%EB%A6%AC/004.%20%EC%97%94%ED%8B%B0%ED%8B%B0%EC%99%80%20%EB%A7%A4%ED%95%91.md#3-identity%EC%99%80-sequence-%EC%B0%A8%EC%9D%B4) 를 참조하자 

### 3. IDENTITY와 SEQUENCE 차이


### 4. 


### 5. 참고자료
1. [Spring-data JPA 공식문서](https://docs.spring.io/spring-data/jpa/docs/current/reference/html/)
2. [spring-data JPA 공식문서 요약본](https://www.baeldung.com/spring-data-jpa-dynamicupdate)
3. [Aaron님의 [JPA] 엔티티와 매핑. @Entity, @Table, @Id, @Column..](https://data-make.tistory.com/610)
4. [heejeong Kwon님의 [JPA] 엔티티 매핑 방법 (Entity Mapping)](https://gmlwjd9405.github.io/2019/08/11/entity-mapping.html)
5. [incheol-jung님의 4장 엔티티 매핑](https://incheol-jung.gitbook.io/docs/study/jpa/4)
6. [choiyeonho903님의 객체와 테이블 매핑](https://choiyeonho903.tistory.com/83)
7. [더블에스님의 JPA - 엔티티 매핑](https://doublesprogramming.tistory.com/260)
8. [developer-ellen 님의 JPA의 엔티티 매핑](https://developer-ellen.tistory.com/188)
9. []()

==
<div align="center"> 
  <img src="" width="" height="" />
  <p>필요할때 가져다 쓰시오.</P>
</div>
==

---
<div align="center">
  <b>긴 글 읽어주셨어 감사합니다.</b><br/><br/>
  아직 많이 배워야 하는 웹린이 입니다.<br/>
  내용에 문제가 있다면 이슈를 통해 알려주신다면 <br>
  감사하겠습니다.
</div>
